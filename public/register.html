<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Student - RFID System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üìù Student Registration</h1>
            <p class="subtitle">Register new students with RFID cards</p>
        </header>

        <section class="card">
            <h2>‚ûï Add New Student</h2>
            
            <div class="form-group">
                <label for="cardId">RFID Card ID: *</label>
                <input 
                    type="text" 
                    id="cardId" 
                    placeholder="Scan card or enter ID (e.g., A1B2C3D4)"
                    required
                >
            </div>

            <div class="form-group">
                <label for="studentName">Student Name: *</label>
                <input 
                    type="text" 
                    id="studentName" 
                    placeholder="e.g., John Doe"
                    required
                >
            </div>

            <div class="form-group">
                <label for="studentClass">Class:</label>
                <input 
                    type="text" 
                    id="studentClass" 
                    placeholder="e.g., 10-A"
                >
            </div>

            <div class="form-group">
                <label for="rollNumber">Roll Number:</label>
                <input 
                    type="text" 
                    id="rollNumber" 
                    placeholder="e.g., 101"
                >
            </div>

            <button id="registerBtn" class="btn-primary">
                ‚úì Register Student
            </button>

            <div id="statusMessage" class="status-message"></div>
        </section>

        <section class="card">
            <h2>üë• Registered Students</h2>
            <button id="refreshBtn" class="btn-secondary">
                üîÑ Refresh List
            </button>
            
            <div id="studentsList" class="records-list">
                <p class="empty-state">Loading students...</p>
            </div>
        </section>

        <footer class="footer">
            <a href="index.html" style="color: #667eea; text-decoration: none;">‚Üê Back to Dashboard</a>
        </footer>
    </div>

    <script>
        // DOM Elements
        const cardIdInput = document.getElementById('cardId');
        const studentNameInput = document.getElementById('studentName');
        const studentClassInput = document.getElementById('studentClass');
        const rollNumberInput = document.getElementById('rollNumber');
        const registerBtn = document.getElementById('registerBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const statusMessage = document.getElementById('statusMessage');
        const studentsList = document.getElementById('studentsList');

        // Event Listeners
        registerBtn.addEventListener('click', registerStudent);
        refreshBtn.addEventListener('click', loadStudents);

        // Register Student
        async function registerStudent() {
            const cardId = cardIdInput.value.trim();
            const name = studentNameInput.value.trim();
            const studentClass = studentClassInput.value.trim();
            const rollNumber = rollNumberInput.value.trim();

            if (!cardId || !name) {
                showStatus('Card ID and Name are required!', 'error');
                return;
            }

            registerBtn.disabled = true;
            registerBtn.textContent = 'Registering...';

            try {
                const response = await fetch('/students/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        cardId: cardId,
                        name: name,
                        studentClass: studentClass,
                        rollNumber: rollNumber
                    })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showStatus(`‚úì ${name} registered successfully!`, 'success');
                    
                    // Clear form
                    cardIdInput.value = '';
                    studentNameInput.value = '';
                    studentClassInput.value = '';
                    rollNumberInput.value = '';
                    
                    // Refresh list
                    loadStudents();
                } else {
                    showStatus(`Error: ${result.message}`, 'error');
                }

            } catch (error) {
                console.error('Error:', error);
                showStatus('Failed to connect to server', 'error');
            } finally {
                registerBtn.disabled = false;
                registerBtn.textContent = '‚úì Register Student';
            }
        }

        // Load Students
        async function loadStudents() {
            try {
                const response = await fetch('/students');
                const result = await response.json();

                if (response.ok && result.success) {
                    displayStudents(result.data);
                } else {
                    studentsList.innerHTML = '<p class="empty-state">Failed to load students</p>';
                }

            } catch (error) {
                console.error('Error:', error);
                studentsList.innerHTML = '<p class="empty-state">Failed to connect to server</p>';
            }
        }

        // Display Students
        function displayStudents(students) {
            if (!students || students.length === 0) {
                studentsList.innerHTML = '<p class="empty-state">No students registered yet</p>';
                return;
            }

            let html = `<p style="color: #666; margin-bottom: 15px;">Total: ${students.length} students</p>`;
            
            students.forEach(student => {
                html += `
                    <div class="record-item">
                        <strong>üë§ ${student.name}</strong><br>
                        <span style="color: #666;">Class: ${student.class || 'N/A'} | Roll: ${student.rollNumber || 'N/A'}</span><br>
                        <span style="color: #999; font-size: 0.85em;">Card ID: ${student.cardId}</span>
                    </div>
                `;
            });

            studentsList.innerHTML = html;
        }

        // Show Status Message
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message show ${type}`;
            
            setTimeout(() => {
                statusMessage.classList.remove('show');
            }, 5000);
        }

        // Load students on page load
        document.addEventListener('DOMContentLoaded', loadStudents);
    </script>
</body>
</html>